<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Trade - TradeAnalytics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .back-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateX(-3px);
        }

        .header h1 {
            color: white;
            font-size: 24px;
            font-weight: 600;
        }

        /* Method Selector */
        .method-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .method-btn {
            padding: 20px 40px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.1);
            color: white;
            backdrop-filter: blur(10px);
        }

        .method-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .method-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        /* Form Container */
        .form-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            display: none;
        }

        .form-container.active {
            display: block;
        }

        .form-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .form-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e1e5e9;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e1e5e9;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* Screenshot Section */
        .screenshot-upload {
            border: 3px dashed #e1e5e9;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .screenshot-upload:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .upload-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #666;
            margin-bottom: 10px;
        }

        .upload-hint {
            color: #999;
            font-size: 14px;
        }

        .screenshot-preview {
            display: none;
            margin-top: 20px;
            text-align: center;
        }

        .screenshot-preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .remove-screenshot {
            margin-top: 10px;
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* API Card */
        .api-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
        }

        .api-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
        }

        .status-connected {
            color: #4ade80;
        }

        .status-disconnected {
            color: #f87171;
        }

        .status-icon {
            font-size: 20px;
        }

        .api-card .form-group label {
            color: rgba(255,255,255,0.9);
        }

        .api-card .form-group input,
        .api-card .form-group select {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.3);
            color: white;
        }

        .api-card .form-group input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e1e5e9;
        }

        .btn-success {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* Required field indicator */
        .required::after {
            content: " *";
            color: #ff4757;
        }

        @media (max-width: 768px) {
            .form-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .method-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .method-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h1>Add New Trade</h1>
        </div>

        <!-- Method Selection -->
        <div class="method-selector">
            <button class="method-btn active" onclick="showMethod('manual')">
                <i class="fas fa-hand-paper"></i> Manual Entry
            </button>
            <button class="method-btn" onclick="showMethod('api')">
                <i class="fas fa-plug"></i> API Import
            </button>
        </div>

        <!-- Manual Entry Form -->
        <div id="manual-form" class="form-container active">
            <div class="form-layout">
                <!-- Left Side - Trade Basics -->
                <div class="form-card">
                    <div class="section-title">
                        <i class="fas fa-info-circle"></i>
                        Trade Basics
                    </div>
                    
                    <div class="form-group">
                        <label for="symbol" class="required">
                            <i class="fas fa-chart-line"></i> Trading Pair / Symbol
                        </label>
                        <input type="text" id="symbol" placeholder="e.g., BTC/USDT, AAPL, EUR/USD" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tradeType" class="required">
                                <i class="fas fa-exchange-alt"></i> Trade Type
                            </label>
                            <select id="tradeType" required>
                                <option value="">Select Trade Type</option>
                                <option value="buy">Buy / Long</option>
                                <option value="sell">Sell / Short</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="category">
                                <i class="fas fa-tags"></i> Category
                            </label>
                            <select id="category">
                                <option value="">Select Category</option>
                                <option value="stocks">Stocks</option>
                                <option value="crypto">Crypto</option>
                                <option value="forex">Forex</option>
                                <option value="commodities">Commodities</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tradeDate" class="required">
                                <i class="fas fa-calendar"></i> Trade Date
                            </label>
                            <input type="date" id="tradeDate" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tradeTime" class="required">
                                <i class="fas fa-clock"></i> Trade Time
                            </label>
                            <input type="time" id="tradeTime" required>
                        </div>
                    </div>
                </div>

                <!-- Right Side - Trade Details & Screenshot -->
                <div class="form-card">
                    <div class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Trade Details
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quantity" class="required">
                                <i class="fas fa-cubes"></i> Quantity
                            </label>
                            <input type="number" id="quantity" placeholder="Quantity" step="0.001" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="entryPrice" class="required">
                                <i class="fas fa-dollar-sign"></i> Entry Price ($)
                            </label>
                            <input type="number" id="entryPrice" placeholder="Entry price" step="0.0001" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="exitPrice">
                                <i class="fas fa-dollar-sign"></i> Exit Price ($)
                            </label>
                            <input type="number" id="exitPrice" placeholder="Exit price" step="0.0001">
                        </div>
                        
                        <div class="form-group">
                            <label for="investment" class="required">
                                <i class="fas fa-money-bill-wave"></i> Investment ($)
                            </label>
                            <input type="number" id="investment" placeholder="Total investment" step="0.01" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="stopLoss">
                                <i class="fas fa-shield-alt"></i> Stop Loss ($)
                            </label>
                            <input type="number" id="stopLoss" placeholder="Stop loss" step="0.0001">
                        </div>
                        
                        <div class="form-group">
                            <label for="takeProfit">
                                <i class="fas fa-trophy"></i> Take Profit ($)
                            </label>
                            <input type="number" id="takeProfit" placeholder="Take profit" step="0.0001">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="strategy">
                            <i class="fas fa-chess"></i> Trading Strategy
                        </label>
                        <input type="text" id="strategy" placeholder="e.g., Breakout, Pullback, Scalping">
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">
                            <i class="fas fa-edit"></i> Trade Notes
                        </label>
                        <textarea id="notes" placeholder="Market analysis, emotions, learnings, etc..." rows="3"></textarea>
                    </div>
                </div>

                <!-- Screenshot Section -->
                <div class="form-card" style="grid-column: 1 / -1;">
                    <div class="section-title">
                        <i class="fas fa-camera"></i>
                        Trade Screenshot
                    </div>
                    
                    <div class="screenshot-upload" id="screenshotUpload">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">
                            Upload Trade Screenshot
                        </div>
                        <div class="upload-hint">
                            Click or drag & drop chart screenshot
                        </div>
                        <input type="file" id="screenshotInput" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="screenshot-preview" id="screenshotPreview">
                        <img id="previewImage" src="" alt="Screenshot Preview">
                        <button type="button" class="remove-screenshot" onclick="removeScreenshot()">
                            <i class="fas fa-trash"></i> Remove Screenshot
                        </button>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="btn-group">
                <button type="button" class="btn btn-secondary" onclick="goBack()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="submitManualTrade()">
                    <i class="fas fa-plus-circle"></i> Add Trade
                </button>
            </div>
        </div>

        <!-- API Import Form -->
        <div id="api-form" class="form-container">
            <div class="form-layout">
                <!-- Left Side - API Configuration -->
                <div class="api-card">
                    <div class="api-status">
                        <i class="fas fa-circle status-icon status-disconnected"></i>
                        <span>Not Connected</span>
                    </div>

                    <div class="section-title">
                        <i class="fas fa-plug"></i>
                        Broker Connection
                    </div>
                    
                    <div class="form-group">
                        <label for="brokerSelect">
                            <i class="fas fa-exchange-alt"></i> Select Broker
                        </label>
                        <select id="brokerSelect">
                            <option value="">Choose your broker</option>
                            <option value="binance">Binance</option>
                            <option value="coinbase">Coinbase Pro</option>
                            <option value="kraken">Kraken</option>
                            <option value="metatrader">MetaTrader</option>
                            <option value="tradingview">TradingView</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="apiKey">
                            <i class="fas fa-key"></i> API Key
                        </label>
                        <input type="password" id="apiKey" placeholder="Enter your API Key">
                    </div>
                    
                    <div class="form-group">
                        <label for="apiSecret">
                            <i class="fas fa-lock"></i> API Secret
                        </label>
                        <input type="password" id="apiSecret" placeholder="Enter your API Secret">
                    </div>

                    <button class="btn btn-success" onclick="connectAPI()">
                        <i class="fas fa-plug"></i> Connect to Broker
                    </button>
                </div>

                <!-- Right Side - API Import -->
                <div class="form-card">
                    <div class="section-title">
                        <i class="fas fa-download"></i>
                        Import Settings
                    </div>
                    
                    <div class="form-group">
                        <label for="importRange">
                            <i class="fas fa-calendar"></i> Import Date Range
                        </label>
                        <select id="importRange">
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="week">Last 7 Days</option>
                            <option value="month">Last 30 Days</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="tradeLimit">
                            <i class="fas fa-list"></i> Max Trades to Import
                        </label>
                        <input type="number" id="tradeLimit" value="50" min="1" max="1000">
                    </div>

                    <div id="importResults" style="display: none;">
                        <div class="section-title">
                            <i class="fas fa-check-circle"></i>
                            Import Results
                        </div>
                        <div id="resultsContent" style="
                            background: rgb(255, 255, 255);
                            padding: 15px;
                            border-radius: 10px;
                            font-size: 14px;
                            color: #666;
                            border: 2px solid #e1e5e9;
                        ">
                            <!-- Results will appear here -->
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="importTrades()" id="importBtn" disabled style="margin-top: 20px;">
                        <i class="fas fa-download"></i> Import Trades
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function goBack() {
            window.history.back();
        }

        // Method Switching
        function showMethod(method) {
            // Update buttons
            document.querySelectorAll('.method-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Show selected form
            document.querySelectorAll('.form-container').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(method + '-form').classList.add('active');
        }

        // Set current date and time for manual form
        document.getElementById('tradeDate').valueAsDate = new Date();
        document.getElementById('tradeTime').value = new Date().toTimeString().substring(0, 5);

        // Screenshot upload functionality
        const screenshotUpload = document.getElementById('screenshotUpload');
        const screenshotInput = document.getElementById('screenshotInput');
        const screenshotPreview = document.getElementById('screenshotPreview');
        const previewImage = document.getElementById('previewImage');

        screenshotUpload.addEventListener('click', () => {
            screenshotInput.click();
        });

        screenshotUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            screenshotUpload.style.borderColor = '#667eea';
            screenshotUpload.style.background = '#f0f4ff';
        });

        screenshotUpload.addEventListener('dragleave', () => {
            screenshotUpload.style.borderColor = '#e1e5e9';
            screenshotUpload.style.background = 'white';
        });

        screenshotUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageUpload(files[0]);
            }
        });

        screenshotInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageUpload(e.target.files[0]);
            }
        });

        function handleImageUpload(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    screenshotPreview.style.display = 'block';
                    screenshotUpload.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function removeScreenshot() {
            screenshotPreview.style.display = 'none';
            screenshotUpload.style.display = 'block';
            screenshotInput.value = '';
        }

        // Calculate PnL when exit price is entered
        document.getElementById('exitPrice').addEventListener('input', calculatePnL);
        document.getElementById('quantity').addEventListener('input', calculatePnL);
        document.getElementById('entryPrice').addEventListener('input', calculatePnL);

        function calculatePnL() {
            const quantity = parseFloat(document.getElementById('quantity').value) || 0;
            const entryPrice = parseFloat(document.getElementById('entryPrice').value) || 0;
            const exitPrice = parseFloat(document.getElementById('exitPrice').value) || 0;
            const tradeType = document.getElementById('tradeType').value;

            if (quantity > 0 && entryPrice > 0 && exitPrice > 0) {
                let pnl;
                if (tradeType === 'buy') {
                    pnl = (exitPrice - entryPrice) * quantity;
                } else if (tradeType === 'sell') {
                    pnl = (entryPrice - exitPrice) * quantity;
                } else {
                    pnl = 0;
                }
                
                // Update PnL display (you can show this to user if needed)
                console.log('Calculated PnL:', pnl);
                return pnl;
            }
            return 0;
        }

        // Manual Trade Submission
        function submitManualTrade() {
            const symbol = document.getElementById('symbol').value;
            const tradeType = document.getElementById('tradeType').value;
            const quantity = parseFloat(document.getElementById('quantity').value);
            const entryPrice = parseFloat(document.getElementById('entryPrice').value);
            const investment = parseFloat(document.getElementById('investment').value);
            const exitPrice = document.getElementById('exitPrice').value ? parseFloat(document.getElementById('exitPrice').value) : null;
            
            if (!symbol || !tradeType || !quantity || !entryPrice || !investment) {
                alert('Please fill all required fields!');
                return;
            }

            // Calculate PnL
            let pnl = 0;
            if (exitPrice) {
                pnl = calculatePnL();
            }

            const tradeData = {
                method: 'manual',
                symbol: symbol,
                tradeType: tradeType,
                category: document.getElementById('category').value || 'other',
                quantity: quantity,
                entryPrice: entryPrice,
                exitPrice: exitPrice,
                investment: investment,
                pnl: pnl,
                stopLoss: document.getElementById('stopLoss').value ? parseFloat(document.getElementById('stopLoss').value) : null,
                takeProfit: document.getElementById('takeProfit').value ? parseFloat(document.getElementById('takeProfit').value) : null,
                tradeDate: document.getElementById('tradeDate').value,
                tradeTime: document.getElementById('tradeTime').value,
                strategy: document.getElementById('strategy').value,
                notes: document.getElementById('notes').value,
                hasScreenshot: screenshotInput.files.length > 0,
                timestamp: new Date().toISOString()
            };

            // Save trade to localStorage
            let trades = JSON.parse(localStorage.getItem('trades')) || [];
            trades.push(tradeData);
            localStorage.setItem('trades', JSON.stringify(trades));
            
            console.log('Trade saved:', tradeData);
            alert('âœ… Trade added successfully!');
            window.location.href = 'index.html';
        }

      </script>
          </script>
    
    <!-- YEH LINE ADD KARO -->
    <script src="api-import.js"></script>
</body>
</html>
</body>
</html>